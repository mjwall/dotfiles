{"_id":"trough","_rev":"1-b567cca79f37aaad5e341acc559ed07e","name":"trough","description":"Middleware: a channel used to convey a liquid","dist-tags":{"latest":"1.0.0"},"versions":{"1.0.0":{"name":"trough","version":"1.0.0","description":"Middleware: a channel used to convey a liquid","license":"MIT","keywords":["middleware","ware"],"dependencies":{},"repository":{"type":"git","url":"git+https://github.com/wooorm/trough.git"},"bugs":{"url":"https://github.com/wooorm/trough/issues"},"author":{"name":"Titus Wormer","email":"tituswormer@gmail.com","url":"http://wooorm.com"},"contributors":[{"name":"Titus Wormer","email":"tituswormer@gmail.com","url":"http://wooorm.com"}],"engines":{"node":">=0.11.0"},"files":["index.js"],"devDependencies":{"browserify":"^13.0.0","esmangle":"^1.0.0","nyc":"^7.1.0","remark-cli":"^1.0.0","remark-comment-config":"^4.0.0","remark-github":"^5.0.0","remark-lint":"^4.0.0","remark-toc":"^3.0.0","remark-validate-links":"^4.0.0","tape":"^4.4.0","xo":"^0.16.0"},"scripts":{"build-md":"remark . --quiet --frail","build-bundle":"browserify index.js -s trough > trough.js","build-mangle":"esmangle trough.js > trough.min.js","build":"npm run build-md && npm run build-bundle && npm run build-mangle","lint":"xo","test-api":"node test","test-coverage":"nyc --reporter lcov tape test.js","test":"npm run build && npm run lint && npm run test-coverage"},"nyc":{"check-coverage":true,"lines":100,"functions":100,"branches":100},"xo":{"space":true,"rules":{"guard-for-in":"off","max-lines":"off"},"ignores":["trough.js","trough.min.js"]},"remarkConfig":{"output":true,"plugins":{"comment-config":null,"lint":{"heading-increment":false,"no-duplicate-headings":false,"list-item-spacing":false},"github":null,"toc":{"tight":true,"maxDepth":3},"validate-links":null},"settings":{"bullet":"*"}},"gitHead":"78f9debf5f756e2b18ce9ff70db4f2907896e3a8","homepage":"https://github.com/wooorm/trough#readme","_id":"trough@1.0.0","_shasum":"6bdedfe7f2aa49a6f3c432257687555957f342fd","_from":".","_npmVersion":"3.3.6","_nodeVersion":"5.0.0","_npmUser":{"name":"wooorm","email":"tituswormer@gmail.com"},"dist":{"shasum":"6bdedfe7f2aa49a6f3c432257687555957f342fd","tarball":"https://registry.npmjs.org/trough/-/trough-1.0.0.tgz"},"maintainers":[{"name":"wooorm","email":"tituswormer@gmail.com"}],"_npmOperationalInternal":{"host":"packages-12-west.internal.npmjs.com","tmp":"tmp/trough-1.0.0.tgz_1470065839549_0.26185039919801056"},"directories":{}}},"readme":"# trough [![Build Status][travis-badge]][travis] [![Coverage Status][codecov-badge]][codecov]\n\n> **trough** /trôf/ — a channel used to convey a liquid.\n\n**trough** is like [`ware`][ware] with less sugar, and middleware\nfunctions can change the input of the next.\n\n## Installation\n\n[npm][]:\n\n```bash\nnpm install trough\n```\n\n## Usage\n\n```js\nvar fs = require('fs');\nvar path = require('path');\nvar trough = require('trough');\n\nvar pipeline = trough()\n  .use(function (fileName) {\n    console.log('Checking... ' + fileName);\n  })\n  .use(function (fileName) {\n    return path.join(process.cwd(), fileName);\n  })\n  .use(function (filePath, next) {\n    fs.stat(filePath, function (err, stats) {\n      next(err, {filePath: filePath, stats: stats});\n    });\n  })\n  .use(function (ctx, next) {\n    if (ctx.stats.isFile()) {\n      fs.readFile(ctx.filePath, next);\n    } else {\n      next(new Error('Expected file'));\n    }\n  });\n\npipeline.run('readme.md', console.log);\npipeline.run('node_modules', console.log);\n```\n\nYields:\n\n```txt\nChecking... readme.md\nChecking... node_modules\nError: Expected file\n    at ~/example.js:18:12\n    at wrapped (~/node_modules/trough/index.js:120:19)\n    at next (~/node_modules/trough/index.js:77:24)\n    at done (~/node_modules/trough/index.js:157:12)\n    at ~/example.js:11:7\n    at FSReqWrap.oncomplete (fs.js:123:15)\nnull <Buffer 23 20 74 72 6f 75 67 68 20 5b 21 5b 42 75 69 6c 64 20 53 74 61 74 75 73 5d 5b 74 72 61 76 69 73 2d 62 61 64 67 65 5d 5d 5b 74 72 61 76 69 73 5d 20 5b ... >\n```\n\n## API\n\n### `trough()`\n\nCreate a new [`Trough`][trough].\n\n### `Trough`\n\nA pipeline.\n\n### `Trough#run([input..., ]done)`\n\nRun the pipeline (all [`use()`][use]d middleware).  Invokes [`done`][done]\non completion with either an error or the output of the last middleware\n\n> Note! as the length of input defines whether [async][] function\n> get a `next` function, it’s recommended to keep `input` at one\n> value normally.\n\n#### `function done(err?, [output...])`\n\nThe final handler passed to [`run()`][run], invoked with an error\nif a [middleware function][fn] rejected, passed, or threw one, or\nthe output of the last middleware function.\n\n### `Trough#use(fn)`\n\nAdd `fn`, a [middleware function][fn], to the pipeline.\n\n#### `function fn([input..., ][next])`\n\nA middleware function invoked with the output of its predecessor.\n\n##### Synchronous\n\nIf `fn` returns or throws an error, the pipeline fails and `done` is\ninvoked with that error.\n\nIf `fn` returns a value (neither `null` nor `undefined`), the first\n`input` of the next function is set to that value (all other `input`\nis passed through).\n\n###### Example\n\nThe following example shows how returning an error stops the pipeline:\n\n```js\nvar trough = require('trough');\n\ntrough().use(function (val) {\n  return new Error('Got: ' + val);\n}).run('some value', console.log);\n```\n\nYields:\n\n```txt\nError: Got: some value\n    at ~example.js:6:10\n    ...\n```\n\nThe following example shows how throwing an error stops the pipeline:\n\n```js\nvar trough = require('trough');\n\ntrough().use(function (val) {\n  throw new Error('Got: ' + val);\n}).run('more value', console.log);\n```\n\nYields:\n\n```txt\nError: Got: more value\n    at ~example.js:6:10\n    ...\n```\n\nThe following example shows how the first output can be modified:\n\n```js\nvar trough = require('trough');\n\ntrough().use(function (val) {\n  return 'even ' + val;\n}).run('more value', 'untouched', console.log);\n```\n\nYields:\n\n```txt\nnull 'even more value' 'untouched'\n```\n\n##### Promise\n\nIf `fn` returns a promise, and that promise rejects, the pipeline fails\nand `done` is invoked with the rejected value.\n\nIf `fn` returns a promise, and that promise resolves with a value\n(neither `null` nor `undefined`), the first `input` of the next function\nis set to that value (all other `input` is passed through).\n\n###### Example\n\nThe following example shows how rejecting a promise stops the pipeline:\n\n```js\ntrough().use(function (val) {\n  return new Promise(function (resolve, reject) {\n    reject('Got: ' + val);\n  });\n}).run('val', console.log);\n```\n\nYields:\n\n```txt\nGot: val\n```\n\nThe following example shows how the input isn’t touched by resolving\nto `null`.\n\n```js\ntrough().use(function (val) {\n  return new Promise(function (resolve, reject) {\n    setTimeout(function () { resolve(null); }, 100);\n  });\n}).run('Input', console.log);\n```\n\nYields:\n\n```txt\nnull 'Input'\n```\n\n##### Asynchronous\n\nIf `fn` accepts one more argument than the given `input`, a `next`\nfunction is given (after the input).  `next` must be called, but doesn’t\nhave to be called async.\n\nIf `next` is given a a value (neither `null` nor `undefined`) as its first\nargument, the pipeline fails and `done` is invoked with that value.\n\nIf `next` is given no value (either `null` or `undefined`) as the first\nargument, all following non-nully values change the input of the following\nfunction, and all nully values default to the `input`.\n\n###### Example\n\nThe following example shows how passing a first argument stops the\npipeline:\n\n```js\ntrough().use(function (val, next) {\n  next(new Error('Got: ' + val));\n}).run('val', console.log);\n```\n\nYields:\n\n```txt\nError: Got: val\n    at ~/example.js:6:8\n```\n\nThe following example shows how more values than the input are passed.\n\n```js\ntrough().use(function (val, next) {\n  setTimeout(function () {\n    next(null, null, 'values');\n  }, 100);\n}).run('some', console.log);\n```\n\nYields:\n\n```txt\nnull 'some' 'values'\n```\n\n## License\n\n[MIT][license] © [Titus Wormer][author]\n\n<!-- Definitions -->\n\n[travis-badge]: https://img.shields.io/travis/wooorm/trough.svg\n\n[travis]: https://travis-ci.org/wooorm/trough\n\n[codecov-badge]: https://img.shields.io/codecov/c/github/wooorm/trough.svg\n\n[codecov]: https://codecov.io/github/wooorm/trough\n\n[npm]: https://docs.npmjs.com/cli/install\n\n[license]: LICENSE\n\n[author]: http://wooorm.com\n\n[ware]: https://github.com/segmentio/ware\n\n[trough]: #trough-1\n\n[use]: #troughusefn\n\n[run]: #troughruninput-done\n\n[fn]: #function-fninput-next\n\n[done]: #function-doneerr-output\n\n[async]: #asynchronous\n","maintainers":[{"name":"wooorm","email":"tituswormer@gmail.com"}],"time":{"modified":"2016-08-01T15:37:21.468Z","created":"2016-08-01T15:37:21.468Z","1.0.0":"2016-08-01T15:37:21.468Z"},"homepage":"https://github.com/wooorm/trough#readme","keywords":["middleware","ware"],"repository":{"type":"git","url":"git+https://github.com/wooorm/trough.git"},"contributors":[{"name":"Titus Wormer","email":"tituswormer@gmail.com","url":"http://wooorm.com"}],"author":{"name":"Titus Wormer","email":"tituswormer@gmail.com","url":"http://wooorm.com"},"bugs":{"url":"https://github.com/wooorm/trough/issues"},"license":"MIT","readmeFilename":"readme.md","_attachments":{},"_etag":"\"57JXVQBWCTWOQ8G9M1LJLLF2B\""}